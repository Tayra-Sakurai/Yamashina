<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Yamashina.Views.MonthlyStat"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Yamashina.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:behaviors="using:CommunityToolkit.WinUI.Behaviors"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:interactivity="using:Microsoft.Xaml.Interactivity"
    xmlns:models="using:Takatsuki.Models"
    mc:Ignorable="d">

    <Page.Resources>
        <XamlUICommand x:Key="SuperCommand"
                       x:Name="SuperCommand"
                       CanExecuteRequested="SuperCommand_CanExecuteRequested"
                       ExecuteRequested="SuperCommand_ExecuteRequested">
            <XamlUICommand.IconSource>
                <SymbolIconSource Symbol="Refresh" />
            </XamlUICommand.IconSource>
        </XamlUICommand>
    </Page.Resources>

    <Grid Background="{ThemeResource SolidBackgroundFillColorBaseBrush}"
          Padding="12,16"
          RowSpacing="8" ColumnSpacing="4">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <TextBlock x:Uid="StatTtl" Style="{StaticResource TitleTextBlockStyle}"
                   Grid.ColumnSpan="3"/>
        <TextBlock Grid.Row="1" Grid.ColumnSpan="3"
                   x:Uid="StatDesc"
                   Style="{StaticResource BodyTextBlockStyle}"/>
        <ListView x:Name="SuperListView"
                  ItemsSource="{x:Bind viewModel.BalanceSheets, Mode=OneWay}"
                  Grid.Row="2" Grid.ColumnSpan="3">
            <ListView.Header>
                <Border Padding="12,4,0,4"
                        Background="{ThemeResource SolidBackgroundFillColorBaseBrush}">
                    <interactivity:Interaction.Behaviors>
                        <behaviors:StickyHeaderBehavior/>
                    </interactivity:Interaction.Behaviors>
                    <controls:DataTable ColumnSpacing="4">
                        <controls:DataColumn x:Uid="IdCol"/>
                        <controls:DataColumn x:Uid="DTCol"
                                             DesiredWidth="144"/>
                        <controls:DataColumn x:Uid="ItCol"
                                             DesiredWidth="3*"/>
                        <controls:DataColumn x:Uid="MtdCol"
                                             DesiredWidth="144"/>
                        <controls:DataColumn x:Uid="BlncCol"
                                             DesiredWidth="*"/>
                    </controls:DataTable>
                </Border>
            </ListView.Header>
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="models:BalanceSheet">
                    <controls:DataRow>
                        <TextBlock Text="{Binding Id}"
                                   VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding DateTime}"
                                   VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding ItemName}"
                                   VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding Method.Name}"
                                   VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding Balance}"
                                   VerticalAlignment="Center"/>
                    </controls:DataRow>
                </DataTemplate>
            </ListView.ItemTemplate>
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem"
                       BasedOn="{StaticResource DefaultListViewItemStyle}">
                    <Setter Property="HorizontalAlignment" Value="Stretch"/>
                </Style>
            </ListView.ItemContainerStyle>
        </ListView>
        <DatePicker DayVisible="False" Date="{x:Bind viewModel.Month, Mode=TwoWay}"
                    x:Uid="MonthPicker" Grid.Row="3"/>
        <ComboBox x:Uid="Method" Grid.Row="3" Grid.Column="1"
                  ItemsSource="{x:Bind viewModel.MethodNames, Mode=OneWay}"
                  SelectedItem="{x:Bind viewModel.MethodName, Mode=TwoWay}"/>
        <CommandBar DefaultLabelPosition="Right"
                    Grid.Row="4" Grid.ColumnSpan="3">
            <AppBarButton x:Uid="Dtl" Command="{StaticResource SuperCommand}"
                          x:Name="SuperCommandButton"
                          CommandParameter="{Binding SelectedItem, ElementName=SuperListView}"/>
            <AppBarButton x:Uid="Sync" Command="{x:Bind viewModel.LoadCommand}"
                          Icon="Sync"/>
        </CommandBar>
    </Grid>
</Page>
